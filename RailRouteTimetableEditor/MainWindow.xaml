<Window 
    x:Class="RailRouteTimetableEditor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:RailRouteTimetableEditor" 
    xmlns:componentmodel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    mc:Ignorable="d"
    Title="Rail Route Timetable Editor" Height="450" Width="800">
    <Window.Resources>        
        <BooleanToVisibilityConverter x:Key="BoolToVis" />        
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid Margin="10" Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal" Grid.Column="0">
                <Button x:Name="FileOpen" Content="Open trains.txt" Padding="20,0" Click="FileOpen_Click" Margin="5"/>
                <Button x:Name="NewTrain" Content="New Train" Padding="20, 0" Click="NewTrain_Click" Margin="5"/>
                <Button x:Name="Save" Content="Save" Padding="20, 0" Click="Save_Click" Margin="5"/>
                <Button x:Name="SaveAs" Content="Save As" Padding="20, 0" Click="SaveAs_Click" Margin="5"/>
                <ProgressBar x:Name="Progress" Width="150" Height="20" Visibility="Hidden" />
            </StackPanel>
                
            <TextBlock HorizontalAlignment="Right" x:Name="FileName" Grid.Column="2"/>
        </Grid>
        <Grid Grid.Row="1" Margin="10" MaxHeight="300">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Vertical" Grid.Column="0">
                <TextBlock Text="Headcode" />
                <TextBox x:Name="Headcode" Width="100" Margin="0,0,0,5"></TextBox>
                <TextBlock Text="Penalty"/>
                <CheckBox x:Name="Penalty" Margin="0,0,0,5"/>
                <TextBlock Text="Train Composition"/>
                <TextBox x:Name="Composition" Width="100" Margin="0,0,0,5" PreviewTextInput="Composition_PreviewTextInput" />
                <TextBlock Text="Maximum Speed"/>
                <TextBox x:Name="MaxSpeed" Margin="0,0,0,5" PreviewTextInput="MaxSpeed_PreviewTextInput" />
                <TextBlock Text="Train Type"/>
                <ComboBox x:Name="Classification" Margin="0,0,0,5" />
                <Button x:Name="Complete" Content="Add Train" Click="Complete_Click"/>
            </StackPanel>
            <ListView 
                x:Name="StationListView" 
                Grid.Column="1" 
                SelectionChanged="StationListView_SelectionChanged" 
                SelectionMode="Single"
                ScrollViewer.VerticalScrollBarVisibility="Visible"
                ScrollViewer.CanContentScroll="False">
                <ListView.ItemTemplate>
                    <DataTemplate DataType="local:Station">
                        <TextBlock Text="{Binding Name}"/>                            
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <ListView x:Name="PlatformListView" Grid.Column="2" SelectionChanged="PlatformListView_SelectionChanged" Visibility="Collapsed" SelectionMode="Single"/>
            <ListView x:Name="TimeTableBuilder" Grid.Column="3">
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <ListView.ItemTemplate>
                    <DataTemplate DataType="local:TimeTableEntry">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="50"/>
                                <ColumnDefinition Width="Auto" MinWidth="10"/>
                                <ColumnDefinition Width="Auto" MinWidth="100"/>
                                <ColumnDefinition Width="Auto" MinWidth="20"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{Binding Station.Name}" Grid.Column="0" Margin="5" Padding="5"/>
                            <TextBox Text="{Binding Platform}" Grid.Column="1" Margin="5" Padding="5" Name="PlatformEdit" PreviewTextInput="PlatformEdit_PreviewTextInput" />
                            <Grid Grid.Column="2">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBox Text="{Binding Arrival}" Grid.Row="0" Margin="5" GotKeyboardFocus="TextBox_GotKeyboardFocus" LostMouseCapture="TextBox_LostMouseCapture" GotMouseCapture="TextBox_GotMouseCapture"/>
                                <TextBox Text="{Binding Departure}" Grid.Row="1" Margin="5" GotKeyboardFocus="TextBox_GotKeyboardFocus" LostMouseCapture="TextBox_LostMouseCapture" GotMouseCapture="TextBox_GotMouseCapture"/>
                                
                            </Grid>
                            <Button x:Name="Delete" Tag="{Binding}" Content="X" Background="Salmon" Foreground="Wheat" Width="30" Height="30" Grid.Column="3" Click="Delete_Click" Margin="5"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>                                
        <TextBlock Grid.Row="2" x:Name="Errors" Foreground="Red"/>
        <StackPanel Orientation="Horizontal" Grid.Row="3">
            <Button x:Name="SortByHeadCode" Content="Headcode" Margin="5" Padding="5" Click="SortByHeadCode_Click"/>
            <Button x:Name="SortByEntryTime" Content="Arrival" Margin="5" Padding="5" Click="SortByEntryTime_Click"/>
            <Button x:Name="SortByCollision" Content="Collisions" Margin="5" Padding="5" Click="SortByCollision_Click"/>
            <TextBlock Text="Search by Headcode" Margin="5" Padding="0 15 0 0" />
            <TextBox x:Name="HeadcodeFilter" TextChanged="HeadcodeFilter_TextChanged" Width="100" Height="30" Margin="5" Padding="5" />
        </StackPanel>
        
        <ListView 
            x:Name="TimetableView"
            Grid.Row="4" 
            ScrollViewer.VerticalScrollBarVisibility="Visible"
            ScrollViewer.CanContentScroll="False">
            <ListView.ItemTemplate>
                <DataTemplate DataType="local:Train">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Button Content="Edit" Grid.Column="0" Tag="{Binding}" x:Name="Edit" Click="Edit_Click"/>
                        <Button Content="X" Grid.Column="1" Tag="{Binding}" Background="Salmon" Foreground="Wheat" x:Name="Delete" Click="Delete_Click_1"/>
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding HeadCode}" FontWeight="Bold" Margin="5" MinWidth="30"/>
                                <TextBlock Grid.Column="1" Text="{Binding Classification}" FontStyle="Oblique" Margin="5" MinWidth="100"/>
                                <TextBlock Grid.Column="2" Text="{Binding Composition}" Margin="5" MinWidth="200"/>
                                <TextBlock Grid.Column="3" Text="{Binding MaxSpeed}" FontFamily="Courier New" Margin="5" MinWidth="25"/>
                                <TextBlock Grid.Column="4" Text="{Binding Penalty}" Margin="5" />
                                <TextBlock Grid.Column="5" Text="Collision" Foreground="OrangeRed" Visibility="{Binding HasCollision, Converter={StaticResource BoolToVis}}" />
                                <Button Grid.Column="6" Content="View" Visibility="{Binding HasCollision, Converter={StaticResource BoolToVis}}" Name="ViewCollisions" Click="ViewCollisions_Click"/>
                            </Grid>
                            <ListView ItemsSource="{Binding TimeTable}" Grid.Row="1">
                                <ListView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ListView.ItemsPanel>
                                <ListView.ItemTemplate>
                                    <DataTemplate DataType="local:TimeTableEntry">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" MinWidth="50"/>
                                                <ColumnDefinition Width="Auto" MinWidth="10"/>
                                                <ColumnDefinition Width="Auto" MinWidth="100"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding Station.Name}" Grid.Column="0" Margin="5" Padding="5"/>
                                            <TextBlock Text="{Binding Platform}" Grid.Column="1" Margin="5" Padding="5" />
                                            <Grid Grid.Column="2">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <TextBlock Text="{Binding Arrival}" Grid.Row="0" Margin="5"/>
                                                <TextBlock Text="{Binding Departure}" Grid.Row="1" Margin="5"/>
                                            </Grid>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </Grid>
                    
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
    
    
</Window>
